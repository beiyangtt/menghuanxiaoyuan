# 管理员与普通用户区分说明

## 一、区分机制

### 1. 管理员判断标准
系统通过 **用户ID (userId)** 来判断是否为管理员：
- **管理员**：`userId = 1` 的用户
- **普通用户**：`userId != 1` 的其他用户

### 2. 判断方法
后端使用 `SecurityUtils.isAdmin(userId)` 方法判断：
```java
public static boolean isAdmin(Long userId) {
    return userId != null && 1L == userId;
}
```

## 二、权限差异

### 1. 内容删除权限

#### 管理员权限
- ✅ 可以删除**任何用户**发布的商品、任务、帖子
- ✅ 拥有最高权限，不受限制

#### 普通用户权限
- ❌ 只能删除**自己发布**的商品、任务、帖子
- ❌ 无法删除其他用户发布的内容

### 2. 菜单访问权限

#### 管理员权限
- ✅ 默认拥有所有菜单权限（包括"内容管理"模块）
- ✅ 可以访问所有功能页面

#### 普通用户权限
- ⚠️ 需要管理员在"系统管理 -> 角色管理"中为其分配相应权限
- ⚠️ 如果没有分配"内容管理"相关权限，则无法看到这些菜单

## 三、如何设置管理员

### 方法1：使用默认管理员账号
系统初始化时会创建一个默认管理员账号：
- **用户名**：`admin`
- **密码**：`admin123`
- **用户ID**：`1`（自动分配）

### 方法2：修改现有用户为管理员
如果需要将其他用户设置为管理员，需要修改数据库：
```sql
-- 注意：此操作需要谨慎，因为管理员拥有最高权限
-- 将用户ID修改为1（需要先确保ID为1的用户不存在或已删除）
UPDATE sys_user SET user_id = 1 WHERE user_name = 'your_username';
```

⚠️ **警告**：系统中只能有一个用户ID为1的管理员，不建议修改。

## 四、如何为普通用户分配权限

### 步骤1：创建角色
1. 登录管理员账号
2. 进入"系统管理 -> 角色管理"
3. 点击"新增"创建新角色（如"内容管理员"）

### 步骤2：分配菜单权限
1. 在角色列表中，点击对应角色的"修改"按钮
2. 在"菜单权限"中勾选需要分配的菜单：
   - ✅ 内容管理
   - ✅ 二手商品
   - ✅ 跑腿任务
   - ✅ 论坛帖子
3. 点击"确定"保存

### 步骤3：分配角色给用户
1. 进入"系统管理 -> 用户管理"
2. 找到需要分配权限的用户，点击"修改"
3. 在"角色"中选择刚才创建的角色
4. 点击"确定"保存

## 五、权限验证位置

### 后端验证
以下三个Controller中都实现了管理员权限检查：

1. **DcSecondhandGoodsController.java**（二手商品）
   ```java
   boolean isAdmin = SecurityUtils.isAdmin(currentUserId);
   if (!isAdmin) {
       // 普通用户只能删除自己发布的商品
   }
   ```

2. **DcErrandTaskController.java**（跑腿任务）
   ```java
   boolean isAdmin = SecurityUtils.isAdmin(currentUserId);
   if (!isAdmin) {
       // 普通用户只能删除自己发布的任务
   }
   ```

3. **DcForumPostController.java**（论坛帖子）
   ```java
   boolean isAdmin = SecurityUtils.isAdmin(currentUserId);
   if (!isAdmin) {
       // 普通用户只能删除自己发布的帖子
   }
   ```

## 六、常见问题

### Q1: 为什么我看不到"内容管理"菜单？
**A:** 可能的原因：
1. 菜单未在数据库中配置（需要执行 `add_content_management_menu.sql`）
2. 当前用户没有分配相应的角色权限
3. 菜单被隐藏（`visible = '1'`）

**解决方法**：
- 执行菜单配置SQL
- 在"角色管理"中为当前用户角色分配"内容管理"相关权限

### Q2: 普通用户如何获得内容管理权限？
**A:** 需要管理员在"系统管理 -> 角色管理"中：
1. 创建或修改角色
2. 勾选"内容管理"相关菜单权限
3. 将该角色分配给用户

### Q3: 如何查看当前登录用户是否为管理员？
**A:** 
- 在用户管理页面查看用户ID，如果为1则是管理员
- 或者尝试删除其他用户发布的内容，如果成功则是管理员

### Q4: 可以创建多个管理员吗？
**A:** 理论上可以，但需要修改代码逻辑。当前系统设计为只有 `userId = 1` 的用户是管理员。如果需要多个管理员，建议：
1. 创建一个"管理员"角色
2. 为该角色分配所有权限
3. 将需要成为管理员的用户分配该角色

## 七、安全建议

1. **保护管理员账号**：管理员账号拥有最高权限，请妥善保管密码
2. **定期审查权限**：定期检查用户角色和权限分配，避免权限过度授予
3. **操作日志**：系统会记录所有删除操作，管理员可以查看操作日志
4. **备份数据**：删除操作不可恢复，建议定期备份数据库

