(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-mine-avatar-index"],{"1bf6":function(t,a,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(a,"__esModule",{value:!0}),a.getUserProfile=function(){return(0,n.default)({url:"/system/user/profile",method:"get"})},a.updateUserProfile=function(t){return(0,n.default)({url:"/system/user/profile",method:"put",data:t})},a.updateUserPwd=function(t,a){var e={oldPassword:t,newPassword:a};return(0,n.default)({url:"/system/user/profile/updatePwd",method:"put",data:e})},a.uploadAvatar=function(t){return(0,i.default)({url:"/system/user/profile/avatar",name:t.name,filePath:t.filePath})};var i=o(e("f1b6")),n=o(e("4fad"))},"390c":function(t,a,e){var o=e("4081");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var i=e("967d").default;i("3a3053ee",o,!0,{sourceMap:!1,shadowMode:!1})},"3b67":function(t,a,e){"use strict";e.r(a);var o=e("f437"),i=e("6949");for(var n in i)["default"].indexOf(n)<0&&function(t){e.d(a,t,(function(){return i[t]}))}(n);e("c48a");var r=e("828b"),c=Object(r["a"])(i["default"],o["b"],o["c"],!1,null,"8622c90a",null,!1,o["a"],void 0);a["default"]=c.exports},4081:function(t,a,e){var o=e("c86c");a=o(!1),a.push([t.i,'.cropper-config[data-v-8622c90a]{padding:%?20?% %?40?%}.cropper-content[data-v-8622c90a]{min-height:%?750?%;width:100%}.uni-corpper[data-v-8622c90a]{position:relative;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;box-sizing:border-box}.uni-corpper-content[data-v-8622c90a]{position:relative}.uni-corpper-content uni-image[data-v-8622c90a]{display:block;width:100%;min-width:0!important;max-width:none!important;height:100%;min-height:0!important;max-height:none!important;image-orientation:0deg!important;margin:0 auto}\n\n/* 移动图片效果 */.uni-cropper-drag-box[data-v-8622c90a]{position:absolute;top:0;right:0;bottom:0;left:0;cursor:move;background:rgba(0,0,0,.6);z-index:1}\n\n/* 内部的信息 */.uni-corpper-crop-box[data-v-8622c90a]{position:absolute;background:hsla(0,0%,100%,.3);z-index:2}.uni-corpper-crop-box .uni-cropper-view-box[data-v-8622c90a]{position:relative;display:block;width:100%;height:100%;overflow:visible;outline:%?1?% solid #69f;outline-color:rgba(102,153,255,.75)}\n\n/* 横向虚线 */.uni-cropper-dashed-h[data-v-8622c90a]{position:absolute;top:33.33333333%;left:0;width:100%;height:33.33333333%;border-top:%?1?% dashed hsla(0,0%,100%,.5);border-bottom:%?1?% dashed hsla(0,0%,100%,.5)}\n\n/* 纵向虚线 */.uni-cropper-dashed-v[data-v-8622c90a]{position:absolute;left:33.33333333%;top:0;width:33.33333333%;height:100%;border-left:%?1?% dashed hsla(0,0%,100%,.5);border-right:%?1?% dashed hsla(0,0%,100%,.5)}\n\n/* 四个方向的线  为了之后的拖动事件*/.uni-cropper-line-t[data-v-8622c90a]{position:absolute;display:block;width:100%;background-color:#69f;top:0;left:0;height:%?1?%;opacity:.1;cursor:n-resize}.uni-cropper-line-t[data-v-8622c90a]::before{content:"";position:absolute;top:50%;right:%?0?%;width:100%;-webkit-transform:translate3d(0,-50%,0);transform:translate3d(0,-50%,0);bottom:0;height:%?41?%;background:transparent;z-index:11}.uni-cropper-line-r[data-v-8622c90a]{position:absolute;display:block;background-color:#69f;top:0;right:%?0?%;width:%?1?%;opacity:.1;height:100%;cursor:e-resize}.uni-cropper-line-r[data-v-8622c90a]::before{content:"";position:absolute;top:0;left:50%;width:%?41?%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);bottom:0;height:100%;background:transparent;z-index:11}.uni-cropper-line-b[data-v-8622c90a]{position:absolute;display:block;width:100%;background-color:#69f;bottom:0;left:0;height:%?1?%;opacity:.1;cursor:s-resize}.uni-cropper-line-b[data-v-8622c90a]::before{content:"";position:absolute;top:50%;right:%?0?%;width:100%;-webkit-transform:translate3d(0,-50%,0);transform:translate3d(0,-50%,0);bottom:0;height:%?41?%;background:transparent;z-index:11}.uni-cropper-line-l[data-v-8622c90a]{position:absolute;display:block;background-color:#69f;top:0;left:0;width:%?1?%;opacity:.1;height:100%;cursor:w-resize}.uni-cropper-line-l[data-v-8622c90a]::before{content:"";position:absolute;top:0;left:50%;width:%?41?%;-webkit-transform:translate3d(-50%,0,0);transform:translate3d(-50%,0,0);bottom:0;height:100%;background:transparent;z-index:11}.uni-cropper-point[data-v-8622c90a]{width:%?5?%;height:%?5?%;background-color:#69f;opacity:.75;position:absolute;z-index:3}.point-t[data-v-8622c90a]{top:%?-3?%;left:50%;margin-left:%?-3?%;cursor:n-resize}.point-tr[data-v-8622c90a]{top:%?-3?%;left:100%;margin-left:%?-3?%;cursor:n-resize}.point-r[data-v-8622c90a]{top:50%;left:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-rb[data-v-8622c90a]{left:100%;top:100%;-webkit-transform:translate3d(-50%,-50%,0);transform:translate3d(-50%,-50%,0);cursor:n-resize;width:%?36?%;height:%?36?%;background-color:#69f;position:absolute;z-index:1112;opacity:1}.point-b[data-v-8622c90a]{left:50%;top:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-bl[data-v-8622c90a]{left:0;top:100%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-l[data-v-8622c90a]{left:0;top:50%;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}.point-lt[data-v-8622c90a]{left:0;top:0;margin-left:%?-3?%;margin-top:%?-3?%;cursor:n-resize}\n\n/* 裁剪框预览内容 */.uni-cropper-viewer[data-v-8622c90a]{position:relative;width:100%;height:100%;overflow:hidden}.uni-cropper-viewer uni-image[data-v-8622c90a]{position:absolute;z-index:2}',""]),t.exports=a},4811:function(t,a,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,e("bf0f"),e("2797"),e("dc8a");var i,n,r,c,s,p,u,d,l,h,v=e("d0b6"),f=o(e("5976")),g=e("1bf6"),m=uni.getSystemInfoSync(),b=m.screenWidth,w=(m.pixelRatio,100),y=m.screenWidth,x={data:function(){return{imageSrc:f.default.getters.avatar,isShowImg:!1,cropperInitW:b,cropperInitH:b,cropperW:b,cropperH:b,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:b,cutR:"100%",qualityWidth:y,innerAspectRadio:1}},onReady:function(){this.loadImage()},methods:{setData:function(t){var a=this;Object.keys(t).forEach((function(e){a.$set(a.$data,e,t[e])}))},getImage:function(){var t=this;uni.chooseImage({success:function(a){t.setData({imageSrc:a.tempFilePaths[0]}),t.loadImage()}})},loadImage:function(){var t=this;uni.getImageInfo({src:t.imageSrc,success:function(a){1,l=b,h=b/1;var e=l>h?l:h;w=e>w?w:e;var o=Math.ceil((b/1-(b/1-w))/2),i=o,n=Math.ceil((b-b+w)/2),r=n;t.setData({cropperW:b,cropperH:b/1,cropperL:Math.ceil((b-b)/2),cropperT:Math.ceil((b-b/1)/2),cutL:n,cutT:o,cutR:r,cutB:i,imageW:l,imageH:h,scaleP:l/b,qualityWidth:y,innerAspectRadio:1}),t.setData({isShowImg:!0}),uni.hideLoading()}})},contentStartMove:function(t){i=t.touches[0].pageX,n=t.touches[0].pageY},contentMoveing:function(t){var a=1*(i-t.touches[0].pageX),e=1*(n-t.touches[0].pageY);a>0?this.cutL-a<0&&(a=this.cutL):this.cutR+a<0&&(a=-this.cutR),e>0?this.cutT-e<0&&(e=this.cutT):this.cutB+e<0&&(e=-this.cutB),this.setData({cutL:this.cutL-a,cutT:this.cutT-e,cutR:this.cutR+a,cutB:this.cutB+e}),i=t.touches[0].pageX,n=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var t=this;uni.showLoading({title:"图片生成中..."});var a=uni.createCanvasContext("myCanvas");a.drawImage(t.imageSrc,0,0,l,h),a.draw(!0,(function(){var a=(t.cropperW-t.cutL-t.cutR)/t.cropperW*l,e=(t.cropperH-t.cutT-t.cutB)/t.cropperH*h,o=t.cutL/t.cropperW*l,i=t.cutT/t.cropperH*h;uni.canvasToTempFilePath({x:o,y:i,width:a,height:e,destWidth:a,destHeight:e,quality:.5,canvasId:"myCanvas",success:function(t){uni.hideLoading();var a={name:"avatarfile",filePath:t.tempFilePath};(0,g.uploadAvatar)(a).then((function(t){var a=(0,v.resolveFileUrl)(t.imgUrl||t.url||"");a&&f.default.commit("SET_AVATAR",a),f.default.dispatch("GetInfo").then((function(){uni.showToast({title:"修改成功",icon:"success"}),uni.navigateBack()})).catch((function(){uni.showToast({title:"修改成功",icon:"success"}),uni.navigateBack()}))}))}})}))},dragStart:function(t){r=t.touches[0].pageX,c=t.touches[0].pageY,s=this.cutL,u=this.cutR,d=this.cutB,p=this.cutT},dragMove:function(t){var a=t.target.dataset.drag;switch(a){case"right":var e=1*(r-t.touches[0].pageX);u+e<0&&(e=-u),this.setData({cutR:u+e});break;case"left":e=1*(r-t.touches[0].pageX);s-e<0&&(e=s),s-e>this.cropperW-this.cutR&&(e=s-(this.cropperW-this.cutR)),this.setData({cutL:s-e});break;case"top":e=1*(c-t.touches[0].pageY);p-e<0&&(e=p),p-e>this.cropperH-this.cutB&&(e=p-(this.cropperH-this.cutB)),this.setData({cutT:p-e});break;case"bottom":e=1*(c-t.touches[0].pageY);d+e<0&&(e=-d),this.setData({cutB:d+e});break;case"rightBottom":var o=1*(r-t.touches[0].pageX),i=1*(c-t.touches[0].pageY);d+i<0&&(i=-d),u+o<0&&(o=-u);var n=d+i,l=u+o;this.setData({cutB:n,cutR:l});break;default:break}}}};a.default=x},6949:function(t,a,e){"use strict";e.r(a);var o=e("4811"),i=e.n(o);for(var n in o)["default"].indexOf(n)<0&&function(t){e.d(a,t,(function(){return o[t]}))}(n);a["default"]=i.a},c48a:function(t,a,e){"use strict";var o=e("390c"),i=e.n(o);i.a},f1b6:function(t,a,e){"use strict";e("6a54");var o=e("f5bd").default;Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0,e("f7a5"),e("bf0f"),e("4626"),e("5ac7");var i=o(e("5976")),n=o(e("e57b")),r=e("dc2b"),c=o(e("cc14")),s=e("d0b6"),p=n.default.baseUrl,u=function(t){var a=!1===(t.headers||{}).isToken;if(t.header=t.header||{},(0,r.getToken)()&&!a&&(t.header["Authorization"]="Bearer "+(0,r.getToken)()),t.params){var e=t.url+"?"+(0,s.tansParams)(t.params);e=e.slice(0,-1),t.url=e}return new Promise((function(a,e){uni.uploadFile({timeout:t.timeout||1e4,url:p+t.url,filePath:t.filePath,name:t.name||"file",header:t.header,formData:t.formData,success:function(t){var o=JSON.parse(t.data),n=o.code||200,r=c.default[n]||o.msg||c.default["default"];200===n?a(o):401==n?((0,s.showConfirm)("登录状态已过期，您可以继续留在该页面，或者重新登录?").then((function(t){t.confirm&&i.default.dispatch("LogOut").then((function(t){uni.reLaunch({url:"/pages/login/login"})}))})),e("无效的会话，或者会话已过期，请重新登录。")):500===n?((0,s.toast)(r),e("500")):200!==n&&((0,s.toast)(r),e(n))},fail:function(t){var a=t.message;"Network Error"==a?a="后端接口连接异常":a.includes("timeout")?a="系统接口请求超时":a.includes("Request failed with status code")&&(a="系统接口"+a.substr(a.length-3)+"异常"),(0,s.toast)(a),e(t)}})}))};a.default=u},f437:function(t,a,e){"use strict";e.d(a,"b",(function(){return o})),e.d(a,"c",(function(){return i})),e.d(a,"a",(function(){}));var o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("v-uni-view",{staticClass:"container"},[e("v-uni-view",{staticClass:"page-body uni-content-info"},[e("v-uni-view",{staticClass:"cropper-content"},[t.isShowImg?e("v-uni-view",{staticClass:"uni-corpper",style:"width:"+t.cropperInitW+"px;height:"+t.cropperInitH+"px;background:#000"},[e("v-uni-view",{staticClass:"uni-corpper-content",style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px;left:"+t.cropperL+"px;top:"+t.cropperT+"px"},[e("v-uni-image",{style:"width:"+t.cropperW+"px;height:"+t.cropperH+"px",attrs:{src:t.imageSrc}}),e("v-uni-view",{staticClass:"uni-corpper-crop-box",style:"left:"+t.cutL+"px;top:"+t.cutT+"px;right:"+t.cutR+"px;bottom:"+t.cutB+"px",on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.contentStartMove.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.contentMoveing.apply(void 0,arguments)},touchend:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.contentTouchEnd.apply(void 0,arguments)}}},[e("v-uni-view",{staticClass:"uni-cropper-view-box"},[e("v-uni-view",{staticClass:"uni-cropper-dashed-h"}),e("v-uni-view",{staticClass:"uni-cropper-dashed-v"}),e("v-uni-view",{staticClass:"uni-cropper-line-t",attrs:{"data-drag":"top"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-line-r",attrs:{"data-drag":"right"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-line-b",attrs:{"data-drag":"bottom"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-line-l",attrs:{"data-drag":"left"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-t",attrs:{"data-drag":"top"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-tr",attrs:{"data-drag":"topTight"}}),e("v-uni-view",{staticClass:"uni-cropper-point point-r",attrs:{"data-drag":"right"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-rb",attrs:{"data-drag":"rightBottom"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-b",attrs:{"data-drag":"bottom"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-bl",attrs:{"data-drag":"bottomLeft"}}),e("v-uni-view",{staticClass:"uni-cropper-point point-l",attrs:{"data-drag":"left"},on:{touchstart:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragStart.apply(void 0,arguments)},touchmove:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.dragMove.apply(void 0,arguments)}}}),e("v-uni-view",{staticClass:"uni-cropper-point point-lt",attrs:{"data-drag":"leftTop"}})],1)],1)],1)],1):t._e()],1),e("v-uni-view",{staticClass:"cropper-config"},[e("v-uni-button",{staticStyle:{"margin-top":"30rpx"},attrs:{type:"primary reverse"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.getImage.apply(void 0,arguments)}}},[t._v(" 选择头像 ")]),e("v-uni-button",{staticStyle:{"margin-top":"30rpx"},attrs:{type:"warn"},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.getImageInfo.apply(void 0,arguments)}}},[t._v(" 提交 ")])],1),e("v-uni-canvas",{style:"position:absolute;border: 1px solid red; width:"+t.imageW+"px;height:"+t.imageH+"px;top:-9999px;left:-9999px;",attrs:{"canvas-id":"myCanvas"}})],1)],1)},i=[]}}]);