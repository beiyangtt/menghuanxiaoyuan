(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-forum-index"],{"0e34":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return o})),a.d(e,"a",(function(){return r}));var r={uniSearchBar:a("0293").default,uniIcons:a("b1c9").default},n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"search-bar"},[a("uni-search-bar",{attrs:{placeholder:"搜索帖子...",clearButton:"auto"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.handleSearch.apply(void 0,arguments)},clear:function(e){arguments[0]=e=t.$handleEvent(e),t.handleClearSearch.apply(void 0,arguments)}},model:{value:t.searchKeyword,callback:function(e){t.searchKeyword=e},expression:"searchKeyword"}})],1),a("v-uni-view",{staticClass:"category-tabs"},[a("v-uni-scroll-view",{staticClass:"tabs-scroll",attrs:{"scroll-x":!0}},t._l(t.categories,(function(e){return a("v-uni-view",{key:e.categoryId,staticClass:"tab-item",class:{active:t.currentCategory===e.categoryId},on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.switchCategory(e.categoryId)}}},[t._v(" "+t._s(e.categoryName)+" ")])})),1)],1),a("v-uni-view",{staticClass:"post-list"},[t.loading?a("v-uni-view",{staticClass:"loading-text"},[t._v("加载中...")]):0===t.postList.length?a("v-uni-view",{staticClass:"empty-text"},[t._v("暂无帖子")]):t._l(t.postList,(function(e){return a("v-uni-view",{key:e.id,staticClass:"post-item",on:{click:function(a){arguments[0]=a=t.$handleEvent(a),t.navigateToDetail(e.id)}}},[a("v-uni-view",{staticClass:"post-header"},[a("v-uni-image",{staticClass:"author-avatar",attrs:{src:e.authorAvatar,mode:"aspectFill"}}),a("v-uni-view",{staticClass:"author-info"},[a("v-uni-text",{staticClass:"author-name"},[t._v(t._s(e.authorName))]),a("v-uni-text",{staticClass:"post-time"},[t._v(t._s(e.publishTime))])],1),a("v-uni-view",{staticClass:"post-category"},[a("v-uni-text",[t._v(t._s(e.category))])],1)],1),a("v-uni-view",{staticClass:"post-content"},[a("v-uni-text",{staticClass:"post-title"},[t._v(t._s(e.title))]),e.summary?a("v-uni-text",{staticClass:"post-summary"},[t._v(t._s(e.summary))]):t._e(),e.images&&e.images.length>0?a("v-uni-view",{staticClass:"post-images"},t._l(e.images.slice(0,3),(function(t,e){return a("v-uni-image",{key:e,staticClass:"post-image",attrs:{src:t,mode:"aspectFill"}})})),1):t._e()],1),a("v-uni-view",{staticClass:"post-footer"},[a("v-uni-view",{staticClass:"footer-item"},[a("uni-icons",{attrs:{type:"chat",size:"18",color:"#999"}}),a("v-uni-text",[t._v(t._s(e.commentCount))])],1),a("v-uni-view",{staticClass:"footer-item"},[a("uni-icons",{attrs:{type:"heart",color:e.isLiked?"#f56c6c":"#999",size:"18"}}),a("v-uni-text",[t._v(t._s(e.likeCount))])],1),a("v-uni-view",{staticClass:"footer-item"},[a("uni-icons",{attrs:{type:"eye",size:"18",color:"#999"}}),a("v-uni-text",[t._v(t._s(e.viewCount))])],1)],1)],1)}))],2),a("v-uni-view",{staticClass:"fab-button",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.navigateToPublish.apply(void 0,arguments)}}},[a("uni-icons",{attrs:{type:"plus",size:"30",color:"#fff"}})],1)],1)},o=[]},2159:function(t,e,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.updateTabBarBadge=function(){return s.apply(this,arguments)};var n=r(a("2634")),o=r(a("2fdc")),i=a("5abf");function s(){return s=(0,o.default)((0,n.default)().mark((function t(){var e,a;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,i.getUnreadCount)();case 3:e=t.sent,200===e.code&&(a=e.data||0,2,a>0?uni.setTabBarBadge({index:2,text:a>99?"99+":String(a)}):uni.removeTabBarBadge({index:2})),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("更新 tabBar 徽章失败:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])}))),s.apply(this,arguments)}},2844:function(t,e,a){"use strict";a.r(e);var r=a("f13a"),n=a.n(r);for(var o in r)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(o);e["default"]=n.a},"30f7":function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},a("7a76"),a("c9b5")},4733:function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if(Array.isArray(t))return(0,r.default)(t)};var r=function(t){return t&&t.__esModule?t:{default:t}}(a("8d0b"))},"5abf":function(t,e,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.deleteChatSession=function(t){return(0,n.default)({url:"/dreamcampus/chat/session/"+t,method:"delete"})},e.deleteSystemMessage=function(t){return(0,n.default)({url:"/dreamcampus/message/"+t,method:"delete"})},e.getChatMessageList=function(t){return(0,n.default)({url:"/dreamcampus/chat/message/list/"+t,method:"get",silent:!0})},e.getChatSession=function(t){return(0,n.default)({url:"/dreamcampus/chat/session/get/"+t,method:"get",silent:!0})},e.getChatSessionList=function(){return(0,n.default)({url:"/dreamcampus/chat/session/list",method:"get"})},e.getMessageList=function(t){return(0,n.default)({url:"/dreamcampus/message/list",method:"get",params:{messageType:t}})},e.getUnreadCount=function(t){return(0,n.default)({url:"/dreamcampus/message/unread/count",method:"get",params:{messageType:t}})},e.markChatAsRead=function(t){return(0,n.default)({url:"/dreamcampus/chat/message/read/"+t,method:"put",silent:!0})},e.markMessageAsRead=function(t){return(0,n.default)({url:"/dreamcampus/message/read/"+t,method:"put"})},e.sendChatMessage=function(t){return(0,n.default)({url:"/dreamcampus/chat/message/send",method:"post",data:t})},e.sendCommentNotification=function(t){return(0,n.default)({url:"/dreamcampus/message/comment/notify",method:"post",data:t})};var n=r(a("4fad"))},"5e19":function(t,e,a){var r=a("c86c");e=r(!1),e.push([t.i,".container[data-v-2ef742db]{background-color:#f5f5f5;min-height:100vh;padding-bottom:%?100?%}.search-bar[data-v-2ef742db]{background-color:#fff;padding:%?20?%}.category-tabs[data-v-2ef742db]{background-color:#fff;padding:%?20?% 0}.tabs-scroll[data-v-2ef742db]{white-space:nowrap}.tab-item[data-v-2ef742db]{display:inline-block;padding:%?10?% %?30?%;margin-left:%?20?%;border-radius:%?30?%;background-color:#f0f0f0;color:#666;font-size:%?28?%}.tab-item.active[data-v-2ef742db]{background-color:#e6a23c;color:#fff}.post-list[data-v-2ef742db]{padding:%?20?%}.post-item[data-v-2ef742db]{background-color:#fff;border-radius:%?20?%;margin-bottom:%?20?%;padding:%?30?%;box-shadow:0 %?2?% %?10?% rgba(0,0,0,.1)}.post-header[data-v-2ef742db]{display:flex;flex-direction:row;align-items:center;margin-bottom:%?20?%}.author-avatar[data-v-2ef742db]{width:%?60?%;height:%?60?%;border-radius:50%;margin-right:%?15?%}.author-info[data-v-2ef742db]{flex:1;display:flex;flex-direction:column}.author-name[data-v-2ef742db]{font-size:%?28?%;color:#333;margin-bottom:%?5?%}.post-time[data-v-2ef742db]{font-size:%?22?%;color:#999}.post-category[data-v-2ef742db]{background-color:#fff7e6;color:#e6a23c;padding:%?5?% %?15?%;border-radius:%?20?%;font-size:%?22?%}.post-content[data-v-2ef742db]{margin-bottom:%?20?%}.post-title[data-v-2ef742db]{font-size:%?32?%;color:#333;font-weight:700;display:block;margin-bottom:%?10?%}.post-summary[data-v-2ef742db]{font-size:%?26?%;color:#666;line-height:1.6;display:block;margin-bottom:%?15?%;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.post-images[data-v-2ef742db]{display:flex;flex-direction:row;margin-top:%?15?%}.post-image[data-v-2ef742db]{width:%?200?%;height:%?200?%;border-radius:%?10?%;margin-right:%?10?%}.post-footer[data-v-2ef742db]{display:flex;flex-direction:row;justify-content:space-around;padding-top:%?20?%;border-top:%?1?% solid #f0f0f0}.footer-item[data-v-2ef742db]{display:flex;align-items:center;font-size:%?24?%;color:#999}.footer-item uni-text[data-v-2ef742db]{margin-left:%?8?%}.fab-button[data-v-2ef742db]{position:fixed;right:%?40?%;bottom:%?120?%;width:%?100?%;height:%?100?%;border-radius:50%;background-color:#e6a23c;display:flex;align-items:center;justify-content:center;box-shadow:0 %?4?% %?12?% rgba(230,162,60,.4);z-index:999}.loading-text[data-v-2ef742db], .empty-text[data-v-2ef742db]{text-align:center;padding:%?40?%;color:#999;font-size:%?28?%}",""]),t.exports=e},"6b95":function(t,e,a){"use strict";var r=a("a06f"),n=a.n(r);n.a},a06f:function(t,e,a){var r=a("5e19");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);var n=a("967d").default;n("594c5403",r,!0,{sourceMap:!1,shadowMode:!1})},a6bf:function(t,e,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.processAvatarUrl=function(t){if(!t||(0,n.isEmpty)(t))return i.default;var e=(0,o.resolveFileUrl)(t);return e||i.default};var n=a("a7d9"),o=a("d0b6"),i=r(a("1313"))},ae6b:function(t,e,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.addComment=function(t){return(0,n.default)({url:"/dreamcampus/forum/comment",method:"post",data:t})},e.addPost=function(t){return(0,n.default)({url:"/dreamcampus/forum",method:"post",data:t})},e.deletePost=function(t){return(0,n.default)({url:"/dreamcampus/forum/"+t,method:"delete"})},e.getCategoryList=function(){return(0,n.default)({url:"/dreamcampus/forum/category/list",method:"get"})},e.getCommentList=function(t){return(0,n.default)({url:"/dreamcampus/forum/comment/list/"+t,method:"get"})},e.getPostDetail=function(t){return(0,n.default)({url:"/dreamcampus/forum/"+t,method:"get"})},e.getPostList=function(t){return(0,n.default)({url:"/dreamcampus/forum/list",method:"get",params:t})},e.toggleLike=function(t){return(0,n.default)({url:"/dreamcampus/forum/like/"+t,method:"put"})},e.updatePost=function(t){return(0,n.default)({url:"/dreamcampus/forum",method:"put",data:t})};var n=r(a("4fad"))},b7c7:function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return(0,r.default)(t)||(0,n.default)(t)||(0,o.default)(t)||(0,i.default)()};var r=s(a("4733")),n=s(a("d14d")),o=s(a("5d6b")),i=s(a("30f7"));function s(t){return t&&t.__esModule?t:{default:t}}},c38b:function(t,e,a){"use strict";a.r(e);var r=a("0e34"),n=a("2844");for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);a("6b95");var i=a("828b"),s=Object(i["a"])(n["default"],r["b"],r["c"],!1,null,"2ef742db",null,!1,r["a"],void 0);e["default"]=s.exports},d14d:function(t,e,a){"use strict";a("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},a("01a2"),a("e39c"),a("bf0f"),a("844d"),a("18f7"),a("de6c"),a("08eb")},f13a:function(t,e,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("bf0f"),a("18f7"),a("de6c"),a("c223"),a("fd3c"),a("0c26"),a("8f71");var n=r(a("b7c7")),o=r(a("2634")),i=r(a("2fdc")),s=a("ae6b"),u=r(a("5976")),d=a("a6bf"),c=a("d0b6"),l=a("2159"),f={data:function(){return{currentCategory:0,categories:[{categoryId:0,categoryName:"全部"}],postList:[],searchKeyword:"",loading:!1,currentUserId:null,hasEntered:!1}},onLoad:function(){this.currentUserId=u.default.getters.id,this.loadCategories(),this.loadPostList()},onShow:function(){this.currentUserId=u.default.getters.id,this.hasEntered?this.loadPostList():this.hasEntered=!0,(0,l.updateTabBarBadge)()},onPullDownRefresh:function(){var t=this;return(0,i.default)((0,o.default)().mark((function e(){return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([t.loadCategories(),t.loadPostList()]);case 3:return e.prev=3,uni.stopPullDownRefresh(),e.finish(3);case 6:case"end":return e.stop()}}),e,null,[[0,,3,6]])})))()},methods:{loadCategories:function(){var t=this;return(0,i.default)((0,o.default)().mark((function e(){var a;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,s.getCategoryList)();case 3:a=e.sent,200===a.code&&(t.categories=[{categoryId:0,categoryName:"全部"}].concat((0,n.default)(a.data))),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("加载分类失败:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},loadPostList:function(){var t=this;return(0,i.default)((0,o.default)().mark((function e(){var a,r;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.prev=1,a={},t.currentCategory>0&&(a.categoryId=t.currentCategory),t.searchKeyword&&(a.postTitle=t.searchKeyword),e.next=7,(0,s.getPostList)(a);case 7:r=e.sent,200===r.code&&(t.postList=r.rows||[],t.postList=t.postList.map((function(e){var a=[];e.images&&e.images.trim()&&(a=e.images.split(",").filter((function(t){return t&&t.trim()})));var r=a.map((function(t){return(0,c.resolveFileUrl)(t)})).filter(Boolean),n="";e.postContent&&(n=e.postContent.length>50?e.postContent.substring(0,50)+"...":e.postContent);var o=e.avatar;return o=e.userId===t.currentUserId&&u.default.getters.avatar?u.default.getters.avatar:(0,d.processAvatarUrl)(o),{id:e.postId,title:e.postTitle,summary:n,authorName:e.nickName||"用户",authorAvatar:o,userId:e.userId,publishTime:t.formatTime(e.createTime),category:e.categoryName||"",commentCount:e.commentCount||0,likeCount:e.likeCount||0,viewCount:e.viewCount||0,isLiked:e.isLiked||!1,images:r}}))),e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](1),console.error("加载帖子列表失败:",e.t0),uni.showToast({title:"加载失败，请重试",icon:"none"});case 15:return e.prev=15,t.loading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[1,11,15,18]])})))()},handleSearch:function(t){this.searchKeyword=t.value||"",this.loadPostList()},handleClearSearch:function(){this.searchKeyword="",this.loadPostList()},switchCategory:function(t){this.currentCategory=t,this.loadPostList()},navigateToDetail:function(t){uni.navigateTo({url:"/pages/forum/detail?id=".concat(t)})},navigateToPublish:function(){uni.navigateTo({url:"/pages/forum/publish"})},formatTime:function(t){return(0,c.formatRelativeTime)(t)}}};e.default=f}}]);